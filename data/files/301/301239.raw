
# Framework for Market Risk calculation

module MarketRisk

using Base.Dates
using InterestRates
using ForwardDiff

export
	HistoricalData,
		HDIndex, HDSpreadCurve,
	RiskFactor,
		RFStock, RFSpotCurrency, RFIRCurve, RFIRCurveVertex,
	PricingModel,
		PMFixedIncome, PMDerivative, PMCash, PMStock, PMBullet, PMForwardCurrency, PMFutureCurrency,
	FinancialContract,
	Scenario,
	getname, price

import Base.hash, Base.isequal

include("types.jl")

# TODO: generate code for getname function
getname(rf::RFSpotCurrency) = rf.name
getname(rf::RFIRCurve) = rf.name
getname(rf::RFStock) = rf.name
getname(hd::HDIndex) = hd.name
getname(hd::HDSpreadCurve) = hd.name

hash(rf::RiskFactor) = hash(getname(rf))
isequal(x::RiskFactor, y::RiskFactor) = getname(x) == getname(y)
(==)(x::RiskFactor, y::RiskFactor) = isequal(x, y)

hash(hd::HistoricalData) = hash(getname(hd))
isequal(x::HistoricalData, y::HistoricalData) = getname(x) == getname(y)
(==)(x::HistoricalData, y::HistoricalData) = isequal(x, y)

getfunctionalcurrency() = error("Function getfunctionalcurrency should be overloaded.")
projectCashFlows(c::FinancialContract, s::Scenario) = error("projectCashFlows not defined for $(p) and $(s)")

_currencyvalue(c::RFSpotCurrency, s::Scenario) = getfunctionalcurrency() == c ? 1.0 : s.data[c]

# Let's multiple-dispatch on pricing models
price(c::FinancialContract, s::Scenario) = _price(c.model, c, s)

include("pricing.jl")

end # module MarketRisk