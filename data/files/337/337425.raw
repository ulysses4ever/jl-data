using Compat
using GeneralizedMaps: GeneralizedMap, cube!, countkcells, collectcelldarts, id
using FactCheck

facts("Test parallelpiped construction.") do
    g = GeneralizedMap(Int64, Int64)
    cube!(g, 2)
    context("Ensure appropriate number of 0-, 1-, 2-, and 3-cells.") do
        rightanswers = [8, 12, 6, 1]
        for (i, x) in enumerate(rightanswers)
            @fact countkcells(g, i-1) => x
        end
    end
    context("Check that collectcelldarts returns the right answers.") do
        @fact map((i) -> foldl((a, x) -> setindex!(a, map(id, collectcelldarts(x[2], i)), id(x[2])), Dict(), g.darts), 0:3) =>
        [{
         1 => [ 1,  8, 42, 43, 24, 17],
         2 => [ 2,  3, 25, 32, 19, 18],
         3 => [ 3,  2, 18, 19, 32, 25],
         4 => [ 4,  5, 33, 40, 27, 26],
         5 => [ 5,  4, 26, 27, 40, 33],
         6 => [ 6,  7, 41, 48, 35, 34],
         7 => [ 7,  6, 34, 35, 48, 41],
         8 => [ 8,  1, 17, 24, 43, 42],
         9 => [ 9, 16, 45, 44, 23, 22],
        10 => [10, 11, 30, 31, 20, 21],
        11 => [11, 10, 21, 20, 31, 30],
        12 => [12, 13, 38, 39, 28, 29],
        13 => [13, 12, 29, 28, 39, 38],
        14 => [14, 15, 46, 47, 36, 37],
        15 => [15, 14, 37, 36, 47, 46],
        16 => [16,  9, 22, 23, 44, 45],
        17 => [17, 24, 43, 42,  8,  1],
        18 => [18, 19, 32, 25,  3,  2],
        19 => [19, 18,  2,  3, 25, 32],
        20 => [20, 21, 10, 11, 30, 31],
        21 => [21, 20, 31, 30, 11, 10],
        22 => [22, 23, 44, 45, 16,  9],
        23 => [23, 22,  9, 16, 45, 44],
        24 => [24, 17,  1,  8, 42, 43],
        25 => [25, 32, 19, 18,  2,  3],
        26 => [26, 27, 40, 33,  5,  4],
        27 => [27, 26,  4,  5, 33, 40],
        28 => [28, 29, 12, 13, 38, 39],
        29 => [29, 28, 39, 38, 13, 12],
        30 => [30, 31, 20, 21, 10, 11],
        31 => [31, 30, 11, 10, 21, 20],
        32 => [32, 25,  3,  2, 18, 19],
        33 => [33, 40, 27, 26,  4,  5],
        34 => [34, 35, 48, 41,  7,  6],
        35 => [35, 34,  6,  7, 41, 48],
        36 => [36, 37, 14, 15, 46, 47],
        37 => [37, 36, 47, 46, 15, 14],
        38 => [38, 39, 28, 29, 12, 13],
        39 => [39, 38, 13, 12, 29, 28],
        40 => [40, 33,  5,  4, 26, 27],
        41 => [41, 48, 35, 34,  6,  7],
        42 => [42, 43, 24, 17,  1,  8],
        43 => [43, 42,  8,  1, 17, 24],
        44 => [44, 45, 16,  9, 22, 23],
        45 => [45, 44, 23, 22,  9, 16],
        46 => [46, 47, 36, 37, 14, 15],
        47 => [47, 46, 15, 14, 37, 36],
        48 => [48, 41,  7,  6, 34, 35] },
        {
         1 => [ 1,  2, 18, 17],  
         2 => [ 2,  1, 17, 18],  
         3 => [ 3,  4, 26, 25],  
         4 => [ 4,  3, 25, 26],  
         5 => [ 5,  6, 34, 33],  
         6 => [ 6,  5, 33, 34],  
         7 => [ 7,  8, 42, 41],  
         8 => [ 8,  7, 41, 42],  
         9 => [ 9, 10, 21, 22],  
        10 => [10,  9, 22, 21],  
        11 => [11, 12, 29, 30],  
        12 => [12, 11, 30, 29],  
        13 => [13, 14, 37, 38],  
        14 => [14, 13, 38, 37],  
        15 => [15, 16, 45, 46],  
        16 => [16, 15, 46, 45],  
        17 => [17, 18,  2,  1],  
        18 => [18, 17,  1,  2],  
        19 => [19, 20, 31, 32],  
        20 => [20, 19, 32, 31],  
        21 => [21, 22,  9, 10],  
        22 => [22, 21, 10,  9],  
        23 => [23, 24, 43, 44],  
        24 => [24, 23, 44, 43],  
        25 => [25, 26,  4,  3],  
        26 => [26, 25,  3,  4],  
        27 => [27, 28, 39, 40],  
        28 => [28, 27, 40, 39],  
        29 => [29, 30, 11, 12],  
        30 => [30, 29, 12, 11],  
        31 => [31, 32, 19, 20],  
        32 => [32, 31, 20, 19],  
        33 => [33, 34,  6,  5],  
        34 => [34, 33,  5,  6],  
        35 => [35, 36, 47, 48],  
        36 => [36, 35, 48, 47],  
        37 => [37, 38, 13, 14],  
        38 => [38, 37, 14, 13],  
        39 => [39, 40, 27, 28],  
        40 => [40, 39, 28, 27],  
        41 => [41, 42,  8,  7],  
        42 => [42, 41,  7,  8],  
        43 => [43, 44, 23, 24],  
        44 => [44, 43, 24, 23],  
        45 => [45, 46, 15, 16],  
        46 => [46, 45, 16, 15],  
        47 => [47, 48, 35, 36],  
        48 => [48, 47, 36, 35] },
        {
         1 => [ 1,  2,  3,  4,  5,  6,  7,  8],  
         2 => [ 2,  1,  8,  7,  6,  5,  4,  3],  
         3 => [ 3,  4,  5,  6,  7,  8,  1,  2],  
         4 => [ 4,  3,  2,  1,  8,  7,  6,  5],  
         5 => [ 5,  6,  7,  8,  1,  2,  3,  4],  
         6 => [ 6,  5,  4,  3,  2,  1,  8,  7],  
         7 => [ 7,  8,  1,  2,  3,  4,  5,  6],  
         8 => [ 8,  7,  6,  5,  4,  3,  2,  1],  
         9 => [ 9, 10, 11, 12, 13, 14, 15, 16],  
        10 => [10,  9, 16, 15, 14, 13, 12, 11],  
        11 => [11, 12, 13, 14, 15, 16,  9, 10],  
        12 => [12, 11, 10,  9, 16, 15, 14, 13],  
        13 => [13, 14, 15, 16,  9, 10, 11, 12],  
        14 => [14, 13, 12, 11, 10,  9, 16, 15],  
        15 => [15, 16,  9, 10, 11, 12, 13, 14],  
        16 => [16, 15, 14, 13, 12, 11, 10,  9],  
        17 => [17, 18, 19, 20, 21, 22, 23, 24],  
        18 => [18, 17, 24, 23, 22, 21, 20, 19],  
        19 => [19, 20, 21, 22, 23, 24, 17, 18],  
        20 => [20, 19, 18, 17, 24, 23, 22, 21],  
        21 => [21, 22, 23, 24, 17, 18, 19, 20],  
        22 => [22, 21, 20, 19, 18, 17, 24, 23],  
        23 => [23, 24, 17, 18, 19, 20, 21, 22],  
        24 => [24, 23, 22, 21, 20, 19, 18, 17],  
        25 => [25, 26, 27, 28, 29, 30, 31, 32],  
        26 => [26, 25, 32, 31, 30, 29, 28, 27],  
        27 => [27, 28, 29, 30, 31, 32, 25, 26],  
        28 => [28, 27, 26, 25, 32, 31, 30, 29],  
        29 => [29, 30, 31, 32, 25, 26, 27, 28],  
        30 => [30, 29, 28, 27, 26, 25, 32, 31],  
        31 => [31, 32, 25, 26, 27, 28, 29, 30],  
        32 => [32, 31, 30, 29, 28, 27, 26, 25],  
        33 => [33, 34, 35, 36, 37, 38, 39, 40],  
        34 => [34, 33, 40, 39, 38, 37, 36, 35],  
        35 => [35, 36, 37, 38, 39, 40, 33, 34],  
        36 => [36, 35, 34, 33, 40, 39, 38, 37],  
        37 => [37, 38, 39, 40, 33, 34, 35, 36],  
        38 => [38, 37, 36, 35, 34, 33, 40, 39],  
        39 => [39, 40, 33, 34, 35, 36, 37, 38],  
        40 => [40, 39, 38, 37, 36, 35, 34, 33],  
        41 => [41, 42, 43, 44, 45, 46, 47, 48],  
        42 => [42, 41, 48, 47, 46, 45, 44, 43],  
        43 => [43, 44, 45, 46, 47, 48, 41, 42],  
        44 => [44, 43, 42, 41, 48, 47, 46, 45],  
        45 => [45, 46, 47, 48, 41, 42, 43, 44],  
        46 => [46, 45, 44, 43, 42, 41, 48, 47],  
        47 => [47, 48, 41, 42, 43, 44, 45, 46],  
        48 => [48, 47, 46, 45, 44, 43, 42, 41] },
        {
         1 => [1,2,3,4,5,6,7,8,42,41,48,47,46,45,44,43,24,23,22,21,20,19,18,17,32,31,30,29,28,27,26,25,40,39,38,37,36,35,34,33,14,13,12,11,10,9,16,15],  
         2 => [2,1,8,7,6,5,4,3,25,26,27,28,29,30,31,32,19,20,21,22,23,24,17,18,43,44,45,46,47,48,41,42,35,36,37,38,39,40,33,34,13,14,15,16,9,10,11,12],  
         3 => [3,4,5,6,7,8,1,2,18,17,24,23,22,21,20,19,32,31,30,29,28,27,26,25,40,39,38,37,36,35,34,33,48,47,46,45,44,43,42,41,16,15,14,13,12,11,10,9],  
         4 => [4,3,2,1,8,7,6,5,33,34,35,36,37,38,39,40,27,28,29,30,31,32,25,26,19,20,21,22,23,24,17,18,43,44,45,46,47,48,41,42,15,16,9,10,11,12,13,14],  
         5 => [5,6,7,8,1,2,3,4,26,25,32,31,30,29,28,27,40,39,38,37,36,35,34,33,48,47,46,45,44,43,42,41,24,23,22,21,20,19,18,17,10,9,16,15,14,13,12,11],  
         6 => [6,5,4,3,2,1,8,7,41,42,43,44,45,46,47,48,35,36,37,38,39,40,33,34,27,28,29,30,31,32,25,26,19,20,21,22,23,24,17,18,9,10,11,12,13,14,15,16],  
         7 => [7,8,1,2,3,4,5,6,34,33,40,39,38,37,36,35,48,47,46,45,44,43,42,41,24,23,22,21,20,19,18,17,32,31,30,29,28,27,26,25,12,11,10,9,16,15,14,13],  
         8 => [8,7,6,5,4,3,2,1,17,18,19,20,21,22,23,24,43,44,45,46,47,48,41,42,35,36,37,38,39,40,33,34,27,28,29,30,31,32,25,26,11,12,13,14,15,16,9,10],  
         9 => [9,10,11,12,13,14,15,16,45,46,47,48,41,42,43,44,23,24,17,18,19,20,21,22,31,32,25,26,27,28,29,30,39,40,33,34,35,36,37,38,6,5,4,3,2,1,8,7],  
        10 => [10,9,16,15,14,13,12,11,30,29,28,27,26,25,32,31,20,19,18,17,24,23,22,21,44,43,42,41,48,47,46,45,36,35,34,33,40,39,38,37,5,6,7,8,1,2,3,4],  
        11 => [11,12,13,14,15,16,9,10,21,22,23,24,17,18,19,20,31,32,25,26,27,28,29,30,39,40,33,34,35,36,37,38,47,48,41,42,43,44,45,46,8,7,6,5,4,3,2,1],  
        12 => [12,11,10,9,16,15,14,13,38,37,36,35,34,33,40,39,28,27,26,25,32,31,30,29,20,19,18,17,24,23,22,21,44,43,42,41,48,47,46,45,7,8,1,2,3,4,5,6],  
        13 => [13,14,15,16,9,10,11,12,29,30,31,32,25,26,27,28,39,40,33,34,35,36,37,38,47,48,41,42,43,44,45,46,23,24,17,18,19,20,21,22,2,1,8,7,6,5,4,3],  
        14 => [14,13,12,11,10,9,16,15,46,45,44,43,42,41,48,47,36,35,34,33,40,39,38,37,28,27,26,25,32,31,30,29,20,19,18,17,24,23,22,21,1,2,3,4,5,6,7,8],  
        15 => [15,16,9,10,11,12,13,14,37,38,39,40,33,34,35,36,47,48,41,42,43,44,45,46,23,24,17,18,19,20,21,22,31,32,25,26,27,28,29,30,4,3,2,1,8,7,6,5],  
        16 => [16,15,14,13,12,11,10,9,22,21,20,19,18,17,24,23,44,43,42,41,48,47,46,45,36,35,34,33,40,39,38,37,28,27,26,25,32,31,30,29,3,4,5,6,7,8,1,2],  
        17 => [17,18,19,20,21,22,23,24,43,44,45,46,47,48,41,42,8,7,6,5,4,3,2,1,25,26,27,28,29,30,31,32,11,12,13,14,15,16,9,10,37,38,39,40,33,34,35,36],  
        18 => [18,17,24,23,22,21,20,19,32,31,30,29,28,27,26,25,3,4,5,6,7,8,1,2,42,41,48,47,46,45,44,43,16,15,14,13,12,11,10,9,38,37,36,35,34,33,40,39],  
        19 => [19,20,21,22,23,24,17,18,2,1,8,7,6,5,4,3,25,26,27,28,29,30,31,32,11,12,13,14,15,16,9,10,45,46,47,48,41,42,43,44,35,36,37,38,39,40,33,34],  
        20 => [20,19,18,17,24,23,22,21,10,9,16,15,14,13,12,11,30,29,28,27,26,25,32,31,3,4,5,6,7,8,1,2,42,41,48,47,46,45,44,43,36,35,34,33,40,39,38,37],  
        21 => [21,22,23,24,17,18,19,20,31,32,25,26,27,28,29,30,11,12,13,14,15,16,9,10,45,46,47,48,41,42,43,44,8,7,6,5,4,3,2,1,33,34,35,36,37,38,39,40],  
        22 => [22,21,20,19,18,17,24,23,44,43,42,41,48,47,46,45,16,15,14,13,12,11,10,9,30,29,28,27,26,25,32,31,3,4,5,6,7,8,1,2,34,33,40,39,38,37,36,35],  
        23 => [23,24,17,18,19,20,21,22,9,10,11,12,13,14,15,16,45,46,47,48,41,42,43,44,8,7,6,5,4,3,2,1,25,26,27,28,29,30,31,32,39,40,33,34,35,36,37,38],  
        24 => [24,23,22,21,20,19,18,17,1,2,3,4,5,6,7,8,42,41,48,47,46,45,44,43,16,15,14,13,12,11,10,9,30,29,28,27,26,25,32,31,40,39,38,37,36,35,34,33],  
        25 => [25,26,27,28,29,30,31,32,19,20,21,22,23,24,17,18,2,1,8,7,6,5,4,3,33,34,35,36,37,38,39,40,13,14,15,16,9,10,11,12,45,46,47,48,41,42,43,44],  
        26 => [26,25,32,31,30,29,28,27,40,39,38,37,36,35,34,33,5,6,7,8,1,2,3,4,18,17,24,23,22,21,20,19,10,9,16,15,14,13,12,11,46,45,44,43,42,41,48,47],  
        27 => [27,28,29,30,31,32,25,26,4,3,2,1,8,7,6,5,33,34,35,36,37,38,39,40,13,14,15,16,9,10,11,12,21,22,23,24,17,18,19,20,43,44,45,46,47,48,41,42],  
        28 => [28,27,26,25,32,31,30,29,12,11,10,9,16,15,14,13,38,37,36,35,34,33,40,39,5,6,7,8,1,2,3,4,18,17,24,23,22,21,20,19,44,43,42,41,48,47,46,45],  
        29 => [29,30,31,32,25,26,27,28,39,40,33,34,35,36,37,38,13,14,15,16,9,10,11,12,21,22,23,24,17,18,19,20,2,1,8,7,6,5,4,3,41,42,43,44,45,46,47,48],  
        30 => [30,29,28,27,26,25,32,31,20,19,18,17,24,23,22,21,10,9,16,15,14,13,12,11,38,37,36,35,34,33,40,39,5,6,7,8,1,2,3,4,42,41,48,47,46,45,44,43],  
        31 => [31,32,25,26,27,28,29,30,11,12,13,14,15,16,9,10,21,22,23,24,17,18,19,20,2,1,8,7,6,5,4,3,33,34,35,36,37,38,39,40,47,48,41,42,43,44,45,46],  
        32 => [32,31,30,29,28,27,26,25,3,4,5,6,7,8,1,2,18,17,24,23,22,21,20,19,10,9,16,15,14,13,12,11,38,37,36,35,34,33,40,39,48,47,46,45,44,43,42,41],  
        33 => [33,34,35,36,37,38,39,40,27,28,29,30,31,32,25,26,4,3,2,1,8,7,6,5,41,42,43,44,45,46,47,48,15,16,9,10,11,12,13,14,21,22,23,24,17,18,19,20],  
        34 => [34,33,40,39,38,37,36,35,48,47,46,45,44,43,42,41,7,8,1,2,3,4,5,6,26,25,32,31,30,29,28,27,12,11,10,9,16,15,14,13,22,21,20,19,18,17,24,23],  
        35 => [35,36,37,38,39,40,33,34,6,5,4,3,2,1,8,7,41,42,43,44,45,46,47,48,15,16,9,10,11,12,13,14,29,30,31,32,25,26,27,28,19,20,21,22,23,24,17,18],  
        36 => [36,35,34,33,40,39,38,37,14,13,12,11,10,9,16,15,46,45,44,43,42,41,48,47,7,8,1,2,3,4,5,6,26,25,32,31,30,29,28,27,20,19,18,17,24,23,22,21],  
        37 => [37,38,39,40,33,34,35,36,47,48,41,42,43,44,45,46,15,16,9,10,11,12,13,14,29,30,31,32,25,26,27,28,4,3,2,1,8,7,6,5,17,18,19,20,21,22,23,24],  
        38 => [38,37,36,35,34,33,40,39,28,27,26,25,32,31,30,29,12,11,10,9,16,15,14,13,46,45,44,43,42,41,48,47,7,8,1,2,3,4,5,6,18,17,24,23,22,21,20,19],  
        39 => [39,40,33,34,35,36,37,38,13,14,15,16,9,10,11,12,29,30,31,32,25,26,27,28,4,3,2,1,8,7,6,5,41,42,43,44,45,46,47,48,23,24,17,18,19,20,21,22],  
        40 => [40,39,38,37,36,35,34,33,5,6,7,8,1,2,3,4,26,25,32,31,30,29,28,27,12,11,10,9,16,15,14,13,46,45,44,43,42,41,48,47,24,23,22,21,20,19,18,17],  
        41 => [41,42,43,44,45,46,47,48,35,36,37,38,39,40,33,34,6,5,4,3,2,1,8,7,17,18,19,20,21,22,23,24,9,10,11,12,13,14,15,16,29,30,31,32,25,26,27,28],  
        42 => [42,41,48,47,46,45,44,43,24,23,22,21,20,19,18,17,1,2,3,4,5,6,7,8,34,33,40,39,38,37,36,35,14,13,12,11,10,9,16,15,30,29,28,27,26,25,32,31],  
        43 => [43,44,45,46,47,48,41,42,8,7,6,5,4,3,2,1,17,18,19,20,21,22,23,24,9,10,11,12,13,14,15,16,37,38,39,40,33,34,35,36,27,28,29,30,31,32,25,26],  
        44 => [44,43,42,41,48,47,46,45,16,15,14,13,12,11,10,9,22,21,20,19,18,17,24,23,1,2,3,4,5,6,7,8,34,33,40,39,38,37,36,35,28,27,26,25,32,31,30,29],  
        45 => [45,46,47,48,41,42,43,44,23,24,17,18,19,20,21,22,9,10,11,12,13,14,15,16,37,38,39,40,33,34,35,36,6,5,4,3,2,1,8,7,25,26,27,28,29,30,31,32],  
        46 => [46,45,44,43,42,41,48,47,36,35,34,33,40,39,38,37,14,13,12,11,10,9,16,15,22,21,20,19,18,17,24,23,1,2,3,4,5,6,7,8,26,25,32,31,30,29,28,27],  
        47 => [47,48,41,42,43,44,45,46,15,16,9,10,11,12,13,14,37,38,39,40,33,34,35,36,6,5,4,3,2,1,8,7,17,18,19,20,21,22,23,24,31,32,25,26,27,28,29,30],  
        48 => [48,47,46,45,44,43,42,41,7,8,1,2,3,4,5,6,34,33,40,39,38,37,36,35,14,13,12,11,10,9,16,15,22,21,20,19,18,17,24,23,32,31,30,29,28,27,26,25] },
        ]
    end
end
