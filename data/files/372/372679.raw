include("jb2048.jl")
include("dag2048.jl")
# julia set working module

# parameters for a 3x3 grid
jb2048.setgamma(jb2048.gamma[2:4,2:4])
jb2048.setcareful([4,6,9,9])
# parameters for a 3x4 grid
jb2048.setgamma(jb2048.gamma[1:3,:])
jb2048.setcareful([4,6,8,12,12])

initgoal,restricted=5,5
g=jb2048.initgame()
xplay!(g,display=true,upgoal=true,verbose=true)

λ,μ=length(maxdag),length(meandag)
log(λ)/log(8)

i=-64
i-=1; h=g.hist[i];plot(h...)
i+=1; h=g.hist[i];plot(h...)
jb2048.back!(g,i)

b=h[1]
b=g.board
t=target(b,upgoal=true)
plot(b)
node=MaxNode(b)
play!(g,moves=1,display=true)

0.94^4*0.43

b=[ 7 5 1 0; 6 2 1 0; 5 2 1 0];plot(b)
x=pack(b)
unpack(x)

@time r=xrepartition(100,verbose=8:12,upgoal=true)
@time r=xrepartition(1000)

empty!(maxdag);empty!(meandag)
gc()

print(r)
println("goal=$initgoal restricted=$restricted -> ",(λ,μ))
print(node)
