module MeshExportModule

L2=3
T3=5
Q4=9
T4=10
H8=12

# Export mesh to a VTK 1.0 file as an unstructured grid.
function vtkexportmesh (theFile::String,Connectivity,Points, Cell_type; scalars=nothing, scalars_name ="scalars_name",binary = false)

    X= Points
    if size(Points, 2)<3
        X=   zeros(size (Points,1),3)
        X [:,1: size(Points,2)] = Points
    end
    # theFile= File name as a string,
    # Connectivity= connectivity array, one row per cell,
    # Points= Coordinate array, one row per point,
    # Cell_type= Cell type code: L2=3, T3=5, Q4=9, T4=10, H8=12
    # options = structure,  with optional attributes:
    # options.binary= Boolean flag, should the file be written as binary?
    # Default is false (file is ASCII).
    # options.scalars =Array of per-node data, same number of rows as  array Points.
    # options.scalars_name = String (no spaces), name for the scalars array.
    # options.vectors =Array of per-node data, same number of rows as  array Points, three columns.
    # options.vectors_name = String (no spaces), name for the vectors array.


    #    if (~strcmp(ext,"vtk"))
    #        theFile = [theFile ".vtk"];
    #    end

    fid=open(theFile,"w");
    if (fid==-1)
        #        warning (['Could not open ' theFile])
        return nothing
    end
    print(fid,"# vtk DataFile Version 1.0\n");
    print(fid,"FinEALE Export\n");
    if (!binary)
        print(fid,"ASCII\n");
    else
        print(fid,"BINARY\n");
    end
    print(fid,"\n");
    print(fid,"DATASET UNSTRUCTURED_GRID\n");
    print(fid,"POINTS ", size(X,1), " double\n");
    if (!binary)
        for i= 1:size(X, 1)
            for j= 1:size(X,2)-1
                print(fid,X[i,j]," ");
            end
            print(fid,X[i,end],"\n");
        end
    else
        fwrite(fid,cast(X,"double"),"double","n");
    end
    print(fid,"\n");
    print(fid,"\n");

    print(fid,"CELLS ",size(Connectivity,1)," ",(size(Connectivity,1)*(size(Connectivity,2)+1)),"\n");
    if (!binary)
        for i= 1:size(Connectivity, 1)
            print(fid,size(Connectivity,2)," ");
            for j= 1:size(Connectivity,2)-1
                print(fid,Connectivity[i,j]-1," ");
            end
            print(fid,Connectivity[i,end]-1,"\n");
        end
    else
        fwrite(fid,cast([zeros(size(f,1),1)+size(f,2),f-1],"int32"),"int32","n");
    end
    print(fid,"\n");
    print(fid,"\n");
    print(fid,"CELL_TYPES ",size(Connectivity,1),"\n");
    if (!binary)
        for i= 1:size(Connectivity,1)
            print(fid,Cell_type,"\n");
        end
    else
        fwrite(fid,cast(ctype,"int32"),"int32","n");
    end

    if scalars!=nothing
        print(fid,"POINT_DATA ",length(scalars),"\n");
        print(fid,"SCALARS ",scalars_name," double\n");
        print(fid,"LOOKUP_TABLE default\n");
        if (!binary)
            for j= 1:length(scalars)
                print(fid,scalars[j],"\n");
            end
        else
            fwrite(fid,cast(scalars,"double"),"double","n");
        end
    end

    #    if (~isempty(vectors))
    #        print(fid,"point_data %d\n",size(vectors,1));
    #        print(fid,"VECTORS %s double\n",vectors_name);
    #        if (~binary)
    #            for j= 1:size(vectors,1)
    #                    print(fid,"%g %g %g\n",vectors(j,:));
    #                end
    #        else
    #            fwrite(fid,cast(vectors,"double"),"double","n");
    #        end
    #    end

    print(fid,"\n");
    fid=close(fid);
    return true
end

end


