using Test

include("Elliptic.jl")
using Elliptic
using Elliptic.Jacobi

### K(m), E(m), ellipke(m), F(pi/2,m), E(pi/2,m) ###

# values from Abramowitz & Stegun, Table 17.1 (p608-609)
#    m            K(m)             E(m)
table17p1 = [
    0.00  1.57079_63267_94897  1.57079_6327;
    0.01  1.57474_55615_17356  1.56686_1942;
    0.10  1.61244_13487_20219  1.53075_7637;
    0.20  1.65962_35986_10528  1.48903_5058;
    0.50  1.85407_46773_01372  1.35064_3881;
    0.90  2.57809_21133_48173  1.10477_4733;
    0.99  3.69563_73629_89875  1.01599_3546;
]

for i = 1:size(table17p1,1)
    m = table17p1[i,1]
    k = table17p1[i,2]
    e = table17p1[i,3]
    @test_approx_eq_eps K(m) k 1e-15
    @test_approx_eq_eps E(m) e 1e-9
    @test_approx_eq_eps F(pi/2,m) k 1e-15
    @test_approx_eq_eps E(pi/2,m) e 1e-9
    a,b = ellipke(m)
    @test_approx_eq_eps a k 1e-15
    @test_approx_eq_eps b e 1e-9

end

@test_approx_eq K(0) pi/2
@test_approx_eq K(0.5) (0.25/sqrt(pi))*gamma(0.25)^2
@test           K(1) == Inf

@test_approx_eq E(0) pi/2
@test_approx_eq E(1) 1

# F(phi,m) ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#                       Abramowitz & Stegun, Table 17.5, p613
#                                    F(phi\alpha)
#  α\φ  0       5            10           15           20           25           30
table17p5_p613 = [
     0. 0  0.08726_646  0.17453_293  0.26179_939  0.34906_585  0.43633_231  0.52359_878;
     2  0  0.08726_660  0.17453_400  0.26180_298  0.34907_428  0.43634_855  0.52362_636;
     4  0  0.08726_700  0.17453_721  0.26181_374  0.34909_952  0.43639_719  0.52370_903;
     6  0  0.08726_767  0.17454_255  0.26183_163  0.34914_148  0.43647_806  0.52384_653;
     8  0  0.08726_860  0.17454_999  0.26185_656  0.34919_998  0.43659_086  0.52403_839;
    10  0  0.08726_980  0.17455_949  0.26188_842  0.34927_479  0.43673_518  0.52428_402;
    12  0  0.08727_124  0.17457_102  0.26192_707  0.34936_558  0.43691_046  0.52458_259;
    14  0  0.08727_294  0.17458_451  0.26197_234  0.34947_200  0.43711_606  0.52493_314;
    16  0  0.08727_487  0.17459_991  0.26202_402  0.34959_358  0.43735_119  0.52533_449;
    18  0  0.08727_703  0.17461_714  0.26208_189  0.34972_983  0.43761_496  0.52578_529;
    20  0  0.08727_940  0.17463_611  0.26214_568  0.34988_016  0.43790_635  0.52628_399;
    22  0  0.08728_199  0.17465_675  0.26221_511  0.35004_395  0.43822_422  0.52682_887;
    24  0  0.08728_477  0.17467_895  0.26228_985  0.35022_048  0.43856_733  0.52741_799;
    26  0  0.08728_773  0.17470_261  0.26236_958  0.35040_901  0.43893_430  0.52804_924;
    28  0  0.08729_086  0.17472_762  0.26245_392  0.35060_870  0.43932_365  0.52872_029;
    30  0  0.08729_413  0.17475_386  0.26254_249  0.35081_868  0.43973_377  0.52942_863;
    32  0  0.08729_755  0.17478_119  0.26263_487  0.35103_803  0.44016_296  0.53017_153;
    34  0  0.08730_108  0.17480_950  0.26273_064  0.35126_576  0.44060_939  0.53094_608;
    36  0  0.08730_472  0.17483_864  0.26282_934  0.35150_083  0.44107_115  0.53174_916;
    38  0  0.08730_844  0.17486_848  0.26293_052  0.35174_218  0.44154_622  0.53257_745;
    40  0  0.08731_222  0.17489_887  0.26303_369  0.35198_869  0.44203_247  0.53342_745;
    42  0  0.08731_606  0.17492_967  0.26313_836  0.35223_920  0.44252_769  0.53429_546;
    44  0  0.08731_992  0.17496_073  0.26324_404  0.35249_254  0.44302_960  0.53517_761;
    46  0  0.08732_379  0.17499_189  0.26335_019  0.35274_748  0.44353_584  0.53606_986;
    48  0  0.08732_765  0.17502_300  0.26345_633  0.35300_280  0.44404_397  0.53696_798;
    50  0  0.08733_149  0.17505_392  0.26356_191  0.35325_724  0.44455_151  0.53786_765;
    52  0  0.08733_528  0.17508_448  0.26366_643  0.35350_955  0.44505_593  0.53876_438;
    54  0  0.08733_901  0.17511_455  0.26376_936  0.35375_845  0.44555_469  0.53965_358;
    56  0  0.08734_265  0.17514_397  0.26387_020  0.35400_269  0.44604_519  0.54053_059;
    58  0  0.08734_620  0.17517_260  0.26396_842  0.35424_101  0.44652_487  0.54139_069;
    60  0  0.08734_962  0.17520_029  0.26406_355  0.35447_217  0.44699_117  0.54222_911;
    62  0  0.08735_291  0.17522_690  0.26415_509  0.35469_497  0.44744_153  0.54304_111;
    64  0  0.08735_605  0.17525_232  0.26424_258  0.35490_823  0.44787_348  0.54382_197;
    66  0  0.08735_902  0.17527_640  0.26432_556  0.35511_081  0.44828_459  0.54456_704;
    68  0  0.08736_182  0.17529_903  0.26440_362  0.35530_160  0.44867_252  0.54527_182;
    70  0  0.08736_442  0.17532_010  0.26447_634  0.35547_959  0.44903_502  0.54593_192;
    72  0  0.08736_681  0.17533_949  0.26454_334  0.35564_377  0.44936_997  0.54654_316;
    74  0  0.08736_898  0.17535_712  0.26460_428  0.35579_326  0.44967_538  0.54710_162;
    76  0  0.08737_092  0.17537_289  0.26465_883  0.35592_721  0.44994_944  0.54760_364;
    78  0  0.08737_262  0.17538_672  0.26470_671  0.35604_488  0.45019_046  0.54804_587;
    80  0  0.08737_408  0.17539_854  0.26474_766  0.35614_560  0.45039_699  0.54842_535;
    82  0  0.08737_528  0.17540_830  0.26478_147  0.35622_881  0.45056_775  0.54873_947;
    84  0  0.08737_622  0.17541_594  0.26480_795  0.35629_402  0.45070_168  0.54898_608;
    86  0  0.08737_689  0.17542_143  0.26482_697  0.35634_086  0.45079_795  0.54916_348;
    88  0  0.08737_730  0.17542_473  0.26483_842  0.35636_908  0.45085_596  0.54927_042;
    90  0  0.08737_744  0.17542_583  0.26484_225  0.35637_851  0.45087_533  0.54930_614;
]

#                       Abramowitz & Stegun, Table 17.5, p614
#                                    F(phi\alpha)
#  α\φ       35           40           45           50           55           60
table17p5_p614 = [
     0. 0.61086_524  0.69813_170  0.78539_816  0.87266_463  0.95993_109  1.04719_755;
     2  0.61090_819  0.69819_436  0.78548_509  0.87278_045  0.96008_037  1.04738_465;
     4  0.61103_691  0.69838_220  0.78574_574  0.87312_784  0.96052_821  1.04794_603;
     6  0.61125_108  0.69869_484  0.78617_974  0.87370_649  0.96127_450  1.04888_194;
     8  0.61155_010  0.69913_161  0.78678_644  0.87451_593  0.96231_911  1.05019_278;
    10  0.61193_318  0.69969_159  0.78756_494  0.87555_545  0.96366_180  1.05187_911;
    12  0.61239_927  0.70037_358  0.78851_403  0.87682_412  0.96530_224  1.05394_160;
    14  0.61294_707  0.70117_608  0.78963_221  0.87832_076  0.96723_998  1.05638_099;
    16  0.61357_504  0.70209_730  0.79091_768  0.88004_389  0.96947_438  1.05919_813;
    18  0.61428_140  0.70313_511  0.79236_827  0.88199_174  0.97200_462  1.06239_384;
    20  0.61506_406  0.70428_706  0.79398_143  0.88416_214  0.97482_960  1.06596_891;
    22  0.61592_071  0.70555_037  0.79575_422  0.88655_254  0.97794_790  1.06992_405;
    24  0.61684_871  0.70692_183  0.79768_324  0.88915_992  0.98135_773  1.07425_976;
    26  0.61784_515  0.70839_788  0.79976_461  0.89198_071  0.98505_681  1.07897_628;
    28  0.61890_682  0.70997_451  0.80199_389  0.89501_076  0.98904_227  1.08407_347;
    30  0.62003_018  0.71164_728  0.80436_610  0.89824_524  0.99331_059  1.08955_067;
    32  0.62121_138  0.71341_124  0.80687_558  0.90167_852  0.99785_743  1.09540_656;
    34  0.62244_622  0.71526_098  0.80951_599  0.90530_415  1.00267_749  1.10163_899;
    36  0.62373_019  0.71719_052  0.81228_024  0.90911_465  1.00776_438  1.10824_474;
    38  0.62505_840  0.71919_335  0.81516_039  0.91310_148  1.01311_039  1.11521_933;
    40  0.62642_563  0.72126_235  0.81814_765  0.91725_487  1.01870_633  1.12255_667;
    42  0.62782_630  0.72338_982  0.82123_227  0.92156_370  1.02454_127  1.13024_880;
    44  0.62925_446  0.72556_741  0.82440_346  0.92601_535  1.03060_230  1.13828_546;
    46  0.63070_385  0.72778_615  0.82764_941  0.93059_558  1.03687_427  1.14665_369;
    48  0.63216_783  0.73003_640  0.83095_712  0.93528_835  1.04333_948  1.15533_731;
    50  0.63363_947  0.73230_789  0.83431_247  0.94007_568  1.04997_735  1.16431_637;
    52  0.63511_150  0.73458_970  0.83770_010  0.94493_756  1.05676_412  1.17356_652;
    54  0.63657_639  0.73687_028  0.84110_344  0.94985_177  1.06367_248  1.18305_833;
    56  0.63802_636  0.73913_751  0.84450_468  0.95479_381  1.07067_128  1.19275_650;
    58  0.63945_343  0.74137_870  0.84788_483  0.95973_682  1.07772_516  1.20261_907;
    60  0.64084_944  0.74358_071  0.85122_375  0.96465_156  1.08479_434  1.21259_661;
    62  0.64220_613  0.74572_998  0.85450_024  0.96950_647  1.09183_436  1.22263_139;
    64  0.64351_521  0.74781_266  0.85769_220  0.97426_773  1.09879_601  1.23265_660;
    66  0.64476_839  0.74981_471  0.86077_677  0.97889_946  1.10562_535  1.24259_576;
    68  0.64595_751  0.75172_208  0.86373_057  0.98336_406  1.11226_392  1.25236_238;
    70  0.64707_458  0.75352_078  0.86652_996  0.98762_253  1.11864_920  1.26185_988;
    72  0.64811_189  0.75519_716  0.86915_135  0.99163_507  1.12471_530  1.27098_218;
    74  0.64906_209  0.75673_800  0.87157_159  0.99536_166  1.13039_401  1.27961_482;
    76  0.64991_829  0.75813_076  0.87376_830  0.99876_287  1.13561_610  1.28763_696;
    78  0.65067_415  0.75936_376  0.87572_037  1.00180_067  1.14031_304  1.29492_436;
    80  0.65132_394  0.76042_640  0.87740_833  1.00443_942  1.14441_892  1.30135_321;
    82  0.65186_270  0.76130_931  0.87881_481  1.00664_678  1.14787_262  1.30680_495;
    84  0.65228_622  0.76200_457  0.87992_495  1.00839_470  1.15062_010  1.31117_166;
    86  0.65259_116  0.76250_582  0.88072_675  1.00966_028  1.15261_652  1.31436_170;
    88  0.65277_510  0.76280_846  0.88121_143  1.01042_658  1.15382_828  1.31630_510;
    90  0.65283_658  0.76290_965  0.88137_359  1.01068_319  1.15423_455  1.31695_790;
]

#                       Abramowitz & Stegun, Table 17.5, p615
#                                    F(phi\alpha)
#  α\φ       65           70           75           80           85           90
table17p5_p615 = [
     0. 1.13446_401  1.22173_048  1.30899_694  1.39626_340  1.48352_986  1.57079_633;
     2  1.13469_294  1.22200_477  1.30931_959  1.39663_672  1.48395_543  1.57127_495;
     4  1.13537_994  1.22282_810  1.31028_822  1.39775_763  1.48523_342  1.57271_244;
     6  1.13652_576  1.22420_180  1.31190_491  1.39962_909  1.48736_769  1.57511_361;
     8  1.13813_158  1.22612_810  1.31417_314  1.40225_598  1.49036_470  1.57848_658;
    10  1.14019_906  1.22861_010  1.31709_778  1.40564_522  1.49423_361  1.58284_280;
    12  1.14273_032  1.23165_180  1.32068_514  1.40980_577  1.49898_627  1.58819_721;
    14  1.14572_789  1.23525_808  1.32494_296  1.41474_871  1.50463_742  1.59456_834;
    16  1.14919_471  1.23943_470  1.32988_047  1.42048_728  1.51120_474  1.60197_853;
    18  1.15313_409  1.24418_827  1.33550_840  1.42703_700  1.51870_904  1.61045_415;
    20  1.15754_967  1.24952_627  1.34183_901  1.43441_578  1.52717_445  1.62002_590;
    22  1.16244_535  1.25545_700  1.34888_616  1.44264_399  1.53662_865  1.63072_910;
    24  1.16782_525  1.26198_957  1.35666_531  1.45174_466  1.54710_309  1.64260_414;
    26  1.17369_362  1.26913_385  1.36519_359  1.46174_360  1.55863_334  1.65569_693;
    28  1.18005_472  1.27690_045  1.37448_981  1.47266_958  1.57125_942  1.67005_943;
    30  1.18691_274  1.28530_059  1.38457_455  1.48455_455  1.58502_624  1.68575_035;
    32  1.19427_162  1.29434_605  1.39547_013  1.49743_384  1.59998_406  1.70283_594;
    34  1.20213_489  1.30404_906  1.40720_064  1.51134_644  1.61618_906  1.72139_083;
    36  1.21050_542  1.31442_210  1.41979_198  1.52633_523  1.63370_398  1.74149_923;
    38  1.21938_520  1.32547_772  1.43327_179  1.54244_734  1.65259_894  1.76325_618;
    40  1.22877_499  1.33722_824  1.44766_938  1.55973_441  1.67295_226  1.78676_913;
    42  1.23867_392  1.34968_545  1.46301_565  1.57825_301  1.69485_156  1.81215_985;
    44  1.24907_904  1.36286_013  1.47934_287  1.59806_493  1.71839_498  1.83956_672;
    46  1.25998_475  1.37676_148  1.49668_437  1.61923_762  1.74369_264  1.86914_755;
    48  1.27138_210  1.39139_640  1.51507_416  1.64184_453  1.77086_836  1.90108_303;
    50  1.28325_798  1.40676_855  1.53454_619  1.66596_542  1.80006_176  1.93558_110;
    52  1.29559_414  1.42287_717  1.55513_354  1.69168_665  1.83143_068  1.97288_227;
    54  1.30836_604  1.43971_560  1.57686_709  1.71910_125  1.86515_414  2.01326_657;
    56  1.32154_149  1.45726_935  1.59977_378  1.74830_880  1.90143_591  2.05706_232;
    58  1.33507_910  1.47551_372  1.62387_409  1.77941_482  1.94050_873  2.10465_766;
    60  1.34892_643  1.49441_087  1.64917_867  1.81252_953  1.98263_957  2.15651_565;
    62  1.36301_803  1.51390_609  1.67568_359  1.84776_547  2.02813_570  2.21319_470;
    64  1.37727_323  1.53392_332  1.70336_398  1.88523_335  2.07735_219  2.27537_643;
    66  1.39159_384  1.55435_972  1.73216_516  1.92503_509  2.13070_052  2.34390_472;
    68  1.40586_195  1.57507_940  1.76199_085  1.96725_237  2.18865_839  2.41984_165;
    70  1.41993_796  1.59590_624  1.79268_736  2.01192_798  2.25177_995  2.50455_008;
    72  1.43365_925  1.61661_644  1.82402_292  2.05903_582  2.32070_416  2.59981_973;
    74  1.44684_001  1.63693_134  1.85566_175  2.10843_282  2.39615_610  2.70806_762;
    76  1.45927_266  1.65651_218  1.88713_308  2.15978_295  2.47892_739  2.83267_258;
    78  1.47073_163  1.67495_873  1.91779_814  2.21243_977  2.56980_281  2.97856_895;
    80  1.48098_006  1.69181_489  1.94682_231  2.26527_326  2.66935_045  3.15338_525;
    82  1.48977_975  1.70658_456  1.97316_666  2.31643_897  2.77736_748  3.36986_803;
    84  1.49690_410  1.71876_033  1.99562_118  2.36313_736  2.89146_664  3.65185_597;
    86  1.50215_336  1.72786_543  2.01290_452  2.40153_358  3.00370_926  4.05275_817;
    88  1.50537_033  1.73350_464  2.02384_126  2.42718_003  3.09448_898  4.74271_727;
    90  1.50645_424  1.73541_516  2.02758_942  2.43624_605  3.13130_133          Inf;
]

table17p5 = [table17p5_p613 table17p5_p614[:,2:end] table17p5_p615[:,2:end]]

for i = 1:size(table17p5,1)
    alpha = table17p5[i,1]
    m = sind(alpha)^2
    for j = 2:size(table17p5,2)
        phid = 5*(j-2)
        phi = degrees2radians(phid)
        f = table17p5[i,j]
        if f == Inf
            @test F(phi,m) == f
            @test F(-phi,m) == -f
            if phid == 90
                @test K(m) == f
            end
        else
            @test_approx_eq_eps F(phi,m) f 1e-8
            @test_approx_eq_eps F(-phi,m) -f 1e-8
            if phid == 90
                @test_approx_eq_eps K(m) f 1e-8
            end
        end
    end
end

@test_approx_eq E(0,0.5) 0
@test_approx_eq E(0.5,0) 0.5
@test_approx_eq E(0.5,1) sin(0.5)

@test_approx_eq F(0,0.5) 0
@test_approx_eq F(0.5,0) 0.5
@test_approx_eq F(0.5,1) log(sec(0.5) + tan(0.5))

# values from Abramowitz & Stegun, Table 17.2 (p610-611)
m20 = sind(20)^2
K20 = 1.62002_58991_24204
E20 = 1.52379_92052_59774
@test_approx_eq_eps K(m20) K20 1e-15
@test_approx_eq_eps E(m20) E20 1e-15

# values from Abramowitz & Stegun, Table 17.5 (p613-615)
# values from Abramowitz & Stegun, Table 17.6 (p616-618)
E2020 = 0.34825_492
F2020 = 0.34988_016
for i = -2:2
    @test_approx_eq_eps E(degrees2radians(20+180i), m20) E2020 + 2i*E20 1e-8
    @test_approx_eq_eps F(degrees2radians(20+180i), m20) F2020 + 2i*K20 1e-8
end

# values from Abramowitz & Stegun, Table 17.9 (p625-626)
@test_approx_eq_eps Pi(0.2, degrees2radians(30), sind(30)^2) 0.53896 1e-5

# values from Abramowitz & Stegun, Table 16.1 (p582-583)
sn(0.672,0.36)
u20 = 20*K20/90
θs2020 = 0.35274_9211
θc2020 = 0.96935_0025/sqrt(secd(20))
θd2020 = 1.02789_45992/sqrt(secd(20))
θn2020 = 1.00369_53131
# sn, cn, dn
@test_approx_eq_eps sn(u20,m20) θs2020/θn2020 1e-9
@test_approx_eq_eps cn(u20,m20) θc2020/θn2020 1e-9
@test_approx_eq_eps dn(u20,m20) θd2020/θn2020 1e-9
# cd, sd, nd
@test_approx_eq_eps cd(u20,m20) θc2020/θd2020 1e-9
@test_approx_eq_eps sd(u20,m20) θs2020/θd2020 1e-9
@test_approx_eq_eps nd(u20,m20) θn2020/θd2020 1e-9
# dc, nc, sc
@test_approx_eq_eps dc(u20,m20) θd2020/θc2020 1e-9
@test_approx_eq_eps nc(u20,m20) θn2020/θc2020 1e-9
@test_approx_eq_eps sc(u20,m20) θs2020/θc2020 1e-9
# ns, ds, cs
@test_approx_eq_eps ns(u20,m20) θn2020/θs2020 4e-9
@test_approx_eq_eps ds(u20,m20) θd2020/θs2020 4e-9
@test_approx_eq_eps cs(u20,m20) θc2020/θs2020 4e-9
# ellipj
s,c,d = ellipj(u20,m20)
@test_approx_eq_eps s θs2020/θn2020 1e-9
@test_approx_eq_eps c θc2020/θn2020 1e-9
@test_approx_eq_eps d θd2020/θn2020 1e-9

for u = -1.:0.21:1.
    @test_approx_eq am(u,0) u
    @test_approx_eq sn(u,0) sin(u)
    @test_approx_eq cn(u,0) cos(u)
    @test_approx_eq dn(u,0) 1.
    @test_approx_eq cd(u,0) cos(u)
    @test_approx_eq sd(u,0) sin(u)
    @test_approx_eq nd(u,0) 1.
    @test_approx_eq dc(u,0) sec(u)
    @test_approx_eq nc(u,0) sec(u)
    @test_approx_eq sc(u,0) tan(u)
    @test_approx_eq ns(u,0) csc(u)
    @test_approx_eq ds(u,0) csc(u)
    @test_approx_eq cs(u,0) cot(u)

    @test_approx_eq am(u,1) atan(sinh(u))
    @test_approx_eq sn(u,1) tanh(u)
    @test_approx_eq cn(u,1) sech(u)
    @test_approx_eq dn(u,1) sech(u)
    @test_approx_eq cd(u,1) 1.
    @test_approx_eq sd(u,1) sinh(u)
    @test_approx_eq nd(u,1) cosh(u)
    @test_approx_eq dc(u,1) 1.
    @test_approx_eq nc(u,1) cosh(u)
    @test_approx_eq sc(u,1) sinh(u)
    @test_approx_eq ns(u,1) coth(u)
    @test_approx_eq ds(u,1) csch(u)
    @test_approx_eq cs(u,1) csch(u)
end
