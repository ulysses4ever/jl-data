#!/usr/bin/env julia
using Docker
using Convenience

const workspace = "workspace"
const machine = Machine("bempp-machine"; create=false, start=false)


create_or_use_directory("Dockerfiles")
create_or_use_directory(workspace)

const build_dir = joinpath(workspace, "build")
create_or_use_directory(build_dir)

activate!(machine) do machine
    const packaging = ["automake", "autoconf", "libtool", "pkg-config",
        "libcurl4-openssl-dev", "intltool", "libxml2-dev", "libgtk2.0-dev",
        "libnotify-dev", "libglib2.0-dev", "libevent-dev", "checkinstall",
        "dh-make", "cdbs", "apt-file"
    ]
    image(machine, "packaging", packaging; user="") |> run
end

include("cookoff.jl")
activate!(machine) do machine
  #= CookOff.prepare() =#
  #= CookOff.make(machine) |> run =#
  CookOff.test(machine) |> run
end
