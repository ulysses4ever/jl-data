using Distributions
using Entropy
using PyPlot

p1 = rand(Dirichlet(1000,0.0007))
p2 = rand(Dirichlet(1000,1))
p3 = [rand(Dirichlet(500,1)),zeros(500)]

d1 = Categorical(p1)
d2 = Categorical(p2)
d3 = Categorical(p3)

nn = int(logspace(1,3.5,20)) # number of samples
n_replicates = 10 # number of replicates at each sample
h = zeros(n_replicates,length(nn),3)

cols = ["r","b"]

figure()
for (i,d) in enumerate((d1,d2,d3))
	subplot(3,1,i)
	for (v,variant) in enumerate((:mle,:shrink))
		for (j,n) = enumerate(nn)
			for k = 1:n_replicates
				x = rand(d,n)
				h[k,j,i] = est_entropy(x;variant=variant,range=[1-1e-12,1000+1e-12])
			end
			plot(ones(n_replicates)*n,h[:,j,i],".",color=cols[v],alpha=0.3)
		end
	end
	true_h = entropy(d) / log(2)
	plot(nn,true_h*ones(length(nn)),"-k")
end
