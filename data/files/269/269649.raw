include("config.jl")
include("genotype.jl")
include("population.jl")

import Genotype
import Config
import Population

function evolve()
    config_vals::Config.Type_Config_Values = Config.Type_Config_Values()
    population::Population.Type_Population = Population.make_population(config_vals)    
    j = 2
    generation_tracker = 0
    first_max_eight = 0
    first_average_three = 0
    first_average_six = 0
    first_average_seven = 0
    for a = 1:100
        for i = convert(Int32, 1):config_vals.num_generations

            max_fitness = 0
            average_fitness = 0
            generation_tracker += 1
            
            Population.evaluate(population, i, config_vals)

            sum = 0
            for k = 1:length(population.genotypes)
                sum += population.genotypes[k].fitness
                if population.genotypes[k].fitness > max_fitness
                    max_fitness = population.genotypes[k].fitness
                end
            end
            average_fitness = sum / config_vals.population_size

            if (max_fitness == 8) & (first_max_eight == 0)
                first_max_eight = generation_tracker
            end
            if (average_fitness >= 3.0) & (first_average_three == 0)
                first_average_three = generation_tracker
            end
            if (average_fitness >= 6.0) & (first_average_six == 0)
                first_average_six = generation_tracker
            end
            if (average_fitness >= 7.0) & (first_average_seven == 0)
                first_average_seven = generation_tracker
            end
            
            #=print(a, " ", i, " ", max_fitness, " ", average_fitness, " ")
            mutation_sum::Int128 = 0
            for i = 1:length(population.mutation_tracker)
                mutation_sum += population.mutation_tracker[i]
            end
            for i = 1:length(population.mutation_tracker)
                print(population.mutation_tracker[i] / mutation_sum, " ")
            end
            println()=#

            if (i % config_vals.generations_per_target_switch) == 0
                println("\n target switch to ", j, "    ", first_max_eight, " ", first_average_three, " ", first_average_six, " ", 
                        first_average_seven, "\n")
                #=mutation_sum::Int128 = 0
                for i = 1:length(population.mutation_tracker)
                mutation_sum += population.mutation_tracker[i]
                end
                for i = 1:length(population.mutation_tracker)
                print(population.mutation_tracker[i] / mutation_sum, " ")
                end
                println()=#
                #Population.print_stats(population, config_vals, false)
                if j == 1
                    j = 2
                else
                    j = 1
                end
                generation_tracker = 0
                Population.switch_target(population, config_vals)
                first_max_eight = 0
                first_average_three = 0
                first_average_six = 0
                first_average_seven = 0
            end
            Population.breed_and_exterminate(population, config_vals)
        end
    end
end

evolve()
