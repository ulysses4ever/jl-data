using Msgpack
using Base.Test

ck_pack(a, b) = pack(a) == b && unpack(b) == a

@test ck_pack(5, [0x05])
@test ck_pack(128, [0xcc,0x80])
@test ck_pack(2^8, [0xcd,0x01,0x00])
@test ck_pack(2^16, [0xce,0x00,0x01,0x00,0x00])
@test ck_pack(2^32, [0xcf,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00])
@test ck_pack(uint64(2^64-1), [0xcf,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff])

@test ck_pack(-5, [0xfb])
@test ck_pack(-32, [0xe0])
@test ck_pack(-33, [0xd0,0xdf])
@test ck_pack(-2^7, [0xd0,0x80])
@test ck_pack(-2^8, [0xd1,0xff,0x00])
@test ck_pack(-2^15, [0xd1,0x80,0x00])
@test ck_pack(-2^16, [0xd2,0xff,0xff,0x00,0x00])
@test ck_pack(-2^31, [0xd2,0x80,0x00,0x00,0x00])
@test ck_pack(-2^32, [0xd3,0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00])
@test ck_pack(-2^63, [0xd3,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00])

@test ck_pack([1,2,3], [0x93,0x01,0x02,0x03])

@test ck_pack({1=>2, "hi"=>"mom"},
              [0x82,0xa2,0x68,0x69,0xa3,0x6d,0x6f,0x6d,0x01,0x02])

@test ck_pack("Меня зовут Шон",
              [0xba,0xd0,0x9c,0xd0,0xb5,0xd0,0xbd,0xd1,0x8f,
               0x20,0xd0,0xb7,0xd0,0xbe,0xd0,0xb2,0xd1,0x83,
               0xd1,0x82,0x20,0xd0,0xa8,0xd0,0xbe,0xd0,0xbd])
