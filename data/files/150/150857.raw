using BestSubsetRegression
using Base.Test

srand(1000)
TOL = 1e-6

# Generate a synthetic problem
# Full β = [10,5,1]
n = 1000
X = rand(n,3)
for i in 1:3
    # Center
    X[:,i] -= mean(X[:,i])
    # Scale
    X[:,i] /= norm(X[:,i])
end
β = [10.0, 5.0, 1.0]
y = X*β
L = norm(y)
y /= L
# Sanity check
@show β
@show L*(X\y)
@test norm(L*(X\y) - β) <= TOL
# Calculate best k solutions manually
opt_βk1 = vcat(X[:,1:1]\y, [0.0,0.0])
opt_βk2 = vcat(X[:,1:2]\y, [0.0])

# Solve for k=1
βk1 = bestsubset(X,y,1)
@show βk1 * L
@test norm(opt_βk1 - βk1) <= TOL
# Solve for k=2
βk2 = bestsubset(X,y,2)
@show βk2 * L
@test norm(opt_βk2 - βk2) <= TOL