# This file is part of Kpax3. License is MIT.

# test exceptions
@test_throws Kpax3DomainError readfasta("data/proper_nt.fasta",
                                        miss=[0x00, 0x3f], t=0)
@test_throws Kpax3DomainError readfasta("data/proper_nt.fasta", l=-1, t=0)

@test_throws Kpax3FASTAError readfasta("data/empty_file.fasta", t=0)
@test_throws Kpax3FASTAError readfasta("data/no_1st_seq.fasta", t=0)
@test_throws Kpax3FASTAError readfasta("data/no_id_char.fasta", t=0)
@test_throws Kpax3FASTAError readfasta("data/no_nth_seq.fasta", t=0)

@test_throws TypeError readfasta("data/utf8_id.fasta", t=0)
@test_throws TypeError readfasta("data/utf8_seq.fasta", t=0)

(data, id, refseq) = readfasta("data/spaces.fasta", t=0)
@test data == UInt8[0x03 0x01;
                    0x01 0x03;
                    0x03 0x02;
                    0x02 0x03;
                    0x01 0x03;
                    0x03 0x02]
@test id == ASCIIString["ID1", "ID5"]
@test refseq == UInt8[0x01, 0x04, 0x03, 0x1d, 0x1d, 0x1d,
                      0x03, 0x1d, 0x1d, 0x01, 0x1d, 0x01]

(data, id, refseq) = readfasta("data/spaces.fasta", l=1, t=0)
@test data == UInt8[0x03 0x01;
                    0x01 0x03;
                    0x03 0x02;
                    0x02 0x03;
                    0x01 0x03;
                    0x03 0x02]
@test id == ASCIIString["ID1", "ID5"]
@test refseq == UInt8[0x01, 0x04, 0x03, 0x1d, 0x1d, 0x1d,
                      0x03, 0x1d, 0x1d, 0x01, 0x1d, 0x01]

(data, id, refseq) = readfasta("data/proper_nt.fasta", t=0)
@test data == UInt8[0x04 0x04 0x04 0x04 0x04 0x02;
                    0x03 0x03 0x01 0x03 0x01 0x01;
                    0x01 0x01 0x00 0x03 0x03 0x00;
                    0x03 0x03 0x03 0x02 0x02 0x02;
                    0x02 0x03 0x01 0x02 0x03 0x02;
                    0x01 0x01 0x01 0x03 0x03 0x04;
                    0x01 0x01 0x04 0x04 0x01 0x01;
                    0x03 0x02 0x03 0x03 0x02 0x03]
@test id == ASCIIString["ID1", "ID2", "ID3", "ID4", "ID5", "ID6"]
@test refseq == UInt8[0x01, 0x1d, 0x03, 0x1d, 0x1d, 0x1d,
                      0x03, 0x1d, 0x1d, 0x1d, 0x1d, 0x01]

(data, id, refseq) = readfasta("data/proper_nt.fasta", l=1, t=0)
@test data == UInt8[0x04 0x04 0x04 0x04 0x04 0x02;
                    0x03 0x03 0x01 0x03 0x01 0x01;
                    0x01 0x01 0x00 0x03 0x03 0x00;
                    0x03 0x03 0x03 0x02 0x02 0x02;
                    0x02 0x03 0x01 0x02 0x03 0x02;
                    0x01 0x01 0x01 0x03 0x03 0x04;
                    0x01 0x01 0x04 0x04 0x01 0x01;
                    0x03 0x02 0x03 0x03 0x02 0x03]
@test id == ASCIIString["ID1", "ID2", "ID3", "ID4", "ID5", "ID6"]
@test refseq == UInt8[0x01, 0x1d, 0x03, 0x1d, 0x1d, 0x1d,
                      0x03, 0x1d, 0x1d, 0x1d, 0x1d, 0x01]

(data, id, refseq) = readfasta("data/proper_nt.fasta", miss=[0x00], t=0)
@test data == UInt8[0x04 0x04 0x04 0x04 0x04 0x02;
                    0x03 0x03 0x01 0x03 0x01 0x01;
                    0x01 0x01 0x1c 0x03 0x03 0x1c;
                    0x03 0x03 0x03 0x02 0x02 0x02;
                    0x02 0x03 0x01 0x02 0x03 0x02;
                    0x01 0x01 0x01 0x03 0x03 0x04;
                    0x01 0x01 0x04 0x04 0x01 0x01;
                    0x03 0x02 0x03 0x03 0x02 0x03;
                    0x01 0x1c 0x01 0x01 0x01 0x01]
@test id == ASCIIString["ID1", "ID2", "ID3", "ID4", "ID5", "ID6"]
@test refseq == UInt8[0x01, 0x1d, 0x03, 0x1d, 0x1d, 0x1d,
                      0x03, 0x1d, 0x1d, 0x1d, 0x1d, 0x1d]

(data, id, refseq) = readfasta("data/proper_aa.fasta", dna=false, t=0)
@test data == UInt8[0x0d 0x0d 0x0d 0x0d 0x0d 0x09;
                    0x0d 0x0d 0x0b 0x0d 0x0b 0x0b;
                    0x0c 0x0c 0x00 0x14 0x14 0x00;
                    0x0c 0x0c 0x0c 0x14 0x14 0x14;
                    0x04 0x0c 0x02 0x04 0x0c 0x04;
                    0x0c 0x0c 0x0c 0x0e 0x0e 0x09;
                    0x02 0x02 0x13 0x13 0x02 0x02;
                    0x01 0x01 0x04 0x01 0x04 0x04]
@test id == ASCIIString["ID1", "ID2", "ID3", "ID4", "ID5", "ID6"]
@test refseq == UInt8[0x0e, 0x1d, 0x01, 0x1d, 0x1d, 0x1d,
                      0x14, 0x1d, 0x1d, 0x1d, 0x1d, 0x0f]

(data, id, refseq) = readfasta("data/proper_aa.fasta", dna=false, l=1, t=0)
@test data == UInt8[0x0d 0x0d 0x0d 0x0d 0x0d 0x09;
                    0x0d 0x0d 0x0b 0x0d 0x0b 0x0b;
                    0x0c 0x0c 0x00 0x14 0x14 0x00;
                    0x0c 0x0c 0x0c 0x14 0x14 0x14;
                    0x04 0x0c 0x02 0x04 0x0c 0x04;
                    0x0c 0x0c 0x0c 0x0e 0x0e 0x09;
                    0x02 0x02 0x13 0x13 0x02 0x02;
                    0x01 0x01 0x04 0x01 0x04 0x04]
@test id == ASCIIString["ID1", "ID2", "ID3", "ID4", "ID5", "ID6"]
@test refseq == UInt8[0x0e, 0x1d, 0x01, 0x1d, 0x1d, 0x1d,
                      0x14, 0x1d, 0x1d, 0x1d, 0x1d, 0x0f]

(data, id, refseq) = readfasta("data/proper_aa.fasta",
                               dna=false, miss=[0x00], t=0)
@test data == UInt8[0x0d 0x0d 0x0d 0x0d 0x0d 0x09;
                    0x0d 0x0d 0x0b 0x0d 0x0b 0x0b;
                    0x0c 0x0c 0x1c 0x14 0x14 0x1c;
                    0x0c 0x0c 0x0c 0x14 0x14 0x14;
                    0x04 0x0c 0x02 0x04 0x0c 0x04;
                    0x0c 0x0c 0x0c 0x0e 0x0e 0x09;
                    0x02 0x02 0x13 0x13 0x02 0x02;
                    0x01 0x01 0x04 0x01 0x04 0x04;
                    0x0f 0x1c 0x0f 0x0f 0x0f 0x0f]
@test id == ASCIIString["ID1", "ID2", "ID3", "ID4", "ID5", "ID6"]
@test refseq == UInt8[0x0e, 0x1d, 0x01, 0x1d, 0x1d, 0x1d,
                      0x14, 0x1d, 0x1d, 0x1d, 0x1d, 0x1d]
