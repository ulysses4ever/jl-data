include("config.jl")
include("preallocation.jl")
include("genotype.jl")
include("population.jl")


import Preallocation
import Genotype
import Config
import Population


function walk()

    NUM_GENOTYPES = 2000000
    NUM_MUTANTS = 50000

    config_vals::Config.Type_Config_Values = Config.Type_Config_Values()
    population = Population.make_population(config_vals)
    genotype = Genotype.make_random_genotype(config_vals)
    dummy_genotype = Genotype.make_random_genotype(config_vals)
    best_genotype = Genotype.make_random_genotype(config_vals)

    target_number = 2

    for i = 1:NUM_GENOTYPES

        
        #best_genotype.fitness = 0
        if i % 4 == 0
            temp = target_number
            while temp == target_number
                temp = rand(2:2:8)
            end
            target_number = temp
            best_genotype.evaluated = false
            Genotype.evaluate(best_genotype, config_vals, target_number, population.preallocation)
        end

        for j = 1:NUM_MUTANTS
            Genotype.copy_into(dummy_genotype, genotype)
            Genotype.mutate_at_global_rate(dummy_genotype, config_vals)
            dummy_genotype.evaluated = false
            Genotype.evaluate(dummy_genotype, config_vals, target_number, population.preallocation)
            if dummy_genotype.fitness >= best_genotype.fitness
                Genotype.copy_into(best_genotype, dummy_genotype)
            end
        end
        println(target_number, " ", i % 10, " ", best_genotype.fitness)
        if best_genotype.fitness == 16
            f1_frequencies = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
            f2_frequencies = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
            f3_frequencies = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
            f4_frequencies = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
            f5_frequencies = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
            f6_frequencies = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
            f7_frequencies = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
            f8_frequencies = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
            
            for i = 1:10000
                Genotype.copy_into(dummy_genotype, best_genotype)
                Genotype.mutate_at_global_rate(dummy_genotype, config_vals)
                Genotype.evaluate(dummy_genotype, config_vals, 1, population.preallocation)
                f1 = dummy_genotype.fitness
                dummy_genotype.evaluated = false
                Genotype.evaluate(dummy_genotype, config_vals, 2, population.preallocation)
                f2 = dummy_genotype.fitness
                dummy_genotype.evaluated = false
                Genotype.evaluate(dummy_genotype, config_vals, 3, population.preallocation)
                f3 = dummy_genotype.fitness
                dummy_genotype.evaluated = false
                Genotype.evaluate(dummy_genotype, config_vals, 4, population.preallocation)
                f4 = dummy_genotype.fitness
                dummy_genotype.evaluated = false
                Genotype.evaluate(dummy_genotype, config_vals, 5, population.preallocation)
                f5 = dummy_genotype.fitness
                dummy_genotype.evaluated = false
                Genotype.evaluate(dummy_genotype, config_vals, 6, population.preallocation)
                f6 = dummy_genotype.fitness
                dummy_genotype.evaluated = false
                Genotype.evaluate(dummy_genotype, config_vals, 7, population.preallocation)
                f7 = dummy_genotype.fitness
                dummy_genotype.evaluated = false
                Genotype.evaluate(dummy_genotype, config_vals, 8, population.preallocation)
                f8 = dummy_genotype.fitness
                if f1 >= 13.0
                    f1_frequencies[round(Int, f1 - 12)] += 1
                end
                if f2 >= 13.0
                    f2_frequencies[round(Int, f2 - 12)] += 1
                end
                if f3 >= 13.0
                    f3_frequencies[round(Int, f3 - 12)] += 1
                end
                if f4 >= 13.0
                    f4_frequencies[round(Int, f4 - 12)] += 1
                end
                if f5 >= 13.0
                    f5_frequencies[round(Int, f5 - 12)] += 1
                end
                if f6 >= 13.0
                    f6_frequencies[round(Int, f6 - 12)] += 1
                end
                if f7 >= 13.0
                    f7_frequencies[round(Int, f7 - 12)] += 1
                end
                if f8 >= 13.0
                    f8_frequencies[round(Int, f8 - 12)] += 1
                end
            end
            println()
            println(f1_frequencies)
            println(f2_frequencies)
            println(f3_frequencies)
            println(f4_frequencies)
            println(f5_frequencies)
            println(f6_frequencies)
            println(f7_frequencies)
            println(f8_frequencies)
            println()
        end
        Genotype.copy_into(genotype, best_genotype)
    end
end

walk()
