include("config.jl")
include("preallocation.jl")
include("genotype.jl")
include("population.jl")

import Genotype
import Config
import Population

function enumerate()

    max_num_genotypes::Int64 = 1000000

    config_vals::Config.Type_Config_Values = Config.Type_Config_Values()
    config_vals.global_weight_mutation_rate = 0.05
    
    population = Population.make_population(config_vals)

    data_file = open("scikit_enumeration_data", "w")
    fitness_file = open("scikit_enumeration_fitness", "w")

    start_genotype::Genotype.Type_Genotype = Genotype.read_from_file(config_vals)
    Genotype.evaluate(start_genotype, config_vals, 1, 1, population.preallocation) 
    println(start_genotype.all_targets_fitnesses)
    Genotype.write_for_scikit(start_genotype, config_vals, data_file)
    write(fitness_file, string(start_genotype.fitness), "\n")

    dictionary::Dict{Array{Int32, 1}, Int64} = Dict{Array{Int32, 1}, Int64}()
    dictionary[vcat(start_genotype.connections, start_genotype.activations, start_genotype.weights, start_genotype.thresholds)] = 0

    temp::Genotype.Type_Genotype = Genotype.make_random_genotype(config_vals)
    println("foo")
    for i = 1:max_num_genotypes
        Genotype.copy_into(temp, start_genotype)
        Genotype.mutate_at_global_rate(temp, config_vals)
        Genotype.evaluate(temp, config_vals, 1, 1, population.preallocation)
        for j = 1:2
            if temp.all_targets_fitnesses[j] > temp.fitness
                temp.fitness = temp.all_targets_fitnesses[j]
            end
        end
        if temp.fitness > 14.0
            index = get(dictionary, vcat(temp.connections, temp.activations, temp.weights, temp.thresholds), -1)
            if index == -1
                dictionary[vcat(temp.connections, temp.activations, temp.weights, temp.thresholds)] = i
                Genotype.write_for_scikit(temp, config_vals, data_file)
                write(fitness_file, string(temp.fitness), "\n")
            end
        end
    end

    close(data_file)
    close(fitness_file)

end

enumerate()

