# see https://github.com/JuliaLang/HttpServer.jl/blob/master/examples/fibonacci.jl

using HttpServer
using JSON

function fibonacci(n)
  if n == 1 return 1 end
  if n == 2 return 1 end
  prev = BigInt(1)
  pprev = BigInt(1)
  for i=3:n
    curr = prev + pprev 
    pprev = prev
    prev = curr
  end
  return prev
end

http = HttpHandler() do req::Request, res::Response
    input = JSON.parse(req.data);
    return Response(json([[i, fibonacci(BigInt(i))] for i in input]))
end

http.events["error"]  = (client, err) -> println(err)
http.events["listen"] = (port)        -> println("Listening on $port...")

server = Server(http)
run(server, 8888)
